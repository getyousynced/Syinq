globalThis.disableIncrementalCache = false;globalThis.disableDynamoDBCache = false;globalThis.openNextDebug = false;globalThis.openNextVersion = "3.0.8";
var d=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var w=(a,t)=>{for(var e in t)d(a,e,{get:t[e],enumerable:!0})},x=(a,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of C(t))!v.call(a,i)&&i!==e&&d(a,i,{get:()=>t[i],enumerable:!(n=T(t,i))||n.enumerable});return a};var y=a=>x(d({},"__esModule",{value:!0}),a);var B={};w(B,{default:()=>g,hasCacheExtension:()=>R});module.exports=y(B);var _=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip"]);function f(a){if(!a)return!1;let t=a?.split(";")[0]??"";return _.has(t)}function c(...a){globalThis.openNextDebug&&console.log(...a)}function m(...a){console.warn(...a)}var E=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],N=a=>E.some(t=>t.clientName===a?.clientName&&t.commandName===a?.commandName&&(t.errorName===a?.error?.name||t.errorName===a?.error?.Code));function u(...a){if(a.some(t=>N(t)))c(...a);else if(a.some(t=>t.__openNextInternal)){let t=a.find(e=>e.__openNextInternal);if(t.logLevel===0){c(...a);return}else if(t.logLevel===1){m(...a);return}else{console.error(...a);return}}else console.error(...a)}var M=/\.(cache|fetch)$/;function R(a){return M.test(a)}var g=class{constructor(t){}async get(t,e){if(globalThis.disableIncrementalCache)return null;let n=typeof e=="object"?e.kindHint?e.kindHint==="fetch":e.fetchCache:e,i=typeof e=="object"?e.softTags:[],o=typeof e=="object"?e.tags:[];return n?this.getFetchCache(t,i,o):this.getIncrementalCache(t)}async getFetchCache(t,e,n){c("get fetch cache",{key:t,softTags:e,tags:n});try{let{value:i,lastModified:o}=await globalThis.incrementalCache.get(t,!0),r=await globalThis.tagCache.getLastModified(t,o);if(r===-1||i===void 0)return null;if((n??[]).length===0&&(await globalThis.tagCache.getByPath(t)).length===0){let l=e?.find(s=>s.startsWith("_N_T_/")&&!s.endsWith("layout")&&!s.endsWith("page"));l&&await globalThis.tagCache.writeTags([{path:t,tag:l}])}return{lastModified:r,value:i}}catch(i){return c("Failed to get fetch cache",i),null}}async getIncrementalCache(t){try{let{value:e,lastModified:n}=await globalThis.incrementalCache.get(t,!1),i=e?.meta,o=await globalThis.tagCache.getLastModified(t,n);if(o===-1)return null;let r=globalThis.__als.getStore()?.requestId??"";return globalThis.lastModified[r]=o,e?.type==="route"?{lastModified:o,value:{kind:"ROUTE",body:Buffer.from(e.body??Buffer.alloc(0),f(String(i?.headers?.["content-type"]))?"base64":"utf8"),status:i?.status,headers:i?.headers}}:e?.type==="page"||e?.type==="app"?{lastModified:o,value:{kind:"PAGE",html:e.html,pageData:e.type==="page"?e.json:e.rsc,status:i?.status,headers:i?.headers}}:e?.type==="redirect"?{lastModified:o,value:{kind:"REDIRECT",props:e.props}}:(m("Unknown cache type",e),null)}catch(e){return c("Failed to get body cache",e),null}}async set(t,e,n){if(globalThis.disableIncrementalCache)return;let i=globalThis.__als.getStore()?.pendingPromiseRunner.withResolvers();try{if(e?.kind==="ROUTE"){let{body:l,status:s,headers:p}=e;await globalThis.incrementalCache.set(t,{type:"route",body:l.toString(f(String(p["content-type"]))?"base64":"utf8"),meta:{status:s,headers:p}},!1)}else if(e?.kind==="PAGE"){let{html:l,pageData:s}=e;typeof s=="string"?await globalThis.incrementalCache.set(t,{type:"app",html:l,rsc:s},!1):await globalThis.incrementalCache.set(t,{type:"page",html:l,json:s},!1)}else e?.kind==="FETCH"?await globalThis.incrementalCache.set(t,e,!0):e?.kind==="REDIRECT"?await globalThis.incrementalCache.set(t,{type:"redirect",props:e.props},!1):e==null&&await globalThis.incrementalCache.delete(t);let o=e?.kind==="FETCH"?n?.tags??e?.data?.tags??[]:e?.kind==="PAGE"?e.headers?.["x-next-cache-tags"]?.split(",")??[]:[];c("derivedTags",o);let r=await globalThis.tagCache.getByPath(t),h=o.filter(l=>!r.includes(l));h.length>0&&await globalThis.tagCache.writeTags(h.map(l=>({path:t,tag:l}))),c("Finished setting cache")}catch(o){u("Failed to set cache",o)}finally{i?.resolve()}}async revalidateTag(t){if(!(globalThis.disableDynamoDBCache||globalThis.disableIncrementalCache))try{let e=Array.isArray(t)?t:[t];for(let n of e){c("revalidateTag",n);let i=await globalThis.tagCache.getByTag(n);c("Items",i);let o=i.map(r=>({path:r,tag:n}));if(n.startsWith("_N_T_/"))for(let r of i){let l=(await globalThis.tagCache.getByPath(r)).filter(s=>!s.startsWith("_N_T_/"));for(let s of l){let p=await globalThis.tagCache.getByTag(s);c({hardTag:s,_paths:p}),o.push(...p.map(b=>({path:b,tag:s})))}}await globalThis.tagCache.writeTags(o)}}catch(e){u("Failed to revalidate tag",e)}}};0&&(module.exports={hasCacheExtension});
